<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Earning Empire</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
:root{
  --bg1:#667eea;--bg2:#764ba2;
  --card:#fff;--text:#111;--muted:#666;
}
*{box-sizing:border-box;margin:0;padding:0;font-family:system-ui}
body{
  background:linear-gradient(135deg,var(--bg1),var(--bg2));
  min-height:100vh;padding-bottom:80px;
}
.app{max-width:420px;margin:auto;padding:12px}
.card{
  background:var(--card);
  border-radius:18px;
  padding:14px;margin-bottom:12px;
  box-shadow:0 8px 25px rgba(0,0,0,.15);
}
h2{font-size:18px}
.muted{color:var(--muted);font-size:13px}
.balance{font-size:34px;font-weight:700;text-align:center}
.btn{
  width:100%;padding:12px;border:none;
  border-radius:999px;
  background:linear-gradient(135deg,#6c63ff,#4facfe);
  color:#fff;font-size:15px;
}
.btn:active{transform:scale(.97)}
.row{display:flex;gap:10px}
.row .btn{flex:1}
.hidden{display:none}

.nav{
  position:fixed;left:0;right:0;bottom:0;
  background:#fff;display:flex;border-top:1px solid #ddd
}
.nav button{
  flex:1;border:none;background:none;
  padding:10px;font-size:12px;
}
</style>
</head>

<body>
<div class="app">

<!-- AUTH -->
<div id="authBox" class="card">
  <h2>Login / Register</h2>
  <input id="email" placeholder="Email" style="width:100%;padding:10px;margin:6px 0">
  <input id="password" type="password" placeholder="Password" style="width:100%;padding:10px;margin:6px 0">
  <button class="btn" onclick="login()">Login</button>
  <button class="btn" style="margin-top:6px" onclick="register()">Register</button>
</div>

<!-- HOME -->
<div id="home" class="page hidden">
  <div class="card">
    <h2>Home</h2>
    <div class="balance"><span id="coinBox">0</span> Coins</div>
    <button class="btn" onclick="earn()">ğŸ® Earn Coins</button>
  </div>
</div>

<!-- WALLET -->
<div id="wallet" class="page hidden">
  <div class="card">
    <h2>Wallet</h2>
    <p>Total Balance: <b id="walletCoins">0</b></p>
  </div>
</div>

<!-- PROFILE -->
<div id="profile" class="page hidden">
  <div class="card">
    <h2>Profile</h2>
    <p>Email: <b id="pEmail"></b></p>
    <p>User ID: <b id="pId"></b></p>
    <p>Referral Code: <b id="pRef"></b></p>
    <button class="btn" onclick="logout()">Logout</button>
  </div>
</div>

<!-- REFERRAL -->
<div id="referral" class="page hidden">
  <div class="card">
    <h2>Referral</h2>
    <p>Your Code: <b id="refCode"></b></p>
  </div>
</div>

<!-- LEADERBOARD -->
<div id="leader" class="page hidden">
  <div class="card">
    <h2>Leaderboard</h2>
    <div id="leaderList"></div>
  </div>
</div>

</div>

<div class="nav">
  <button onclick="openPage('home')">ğŸ  Home</button>
  <button onclick="openPage('wallet')">ğŸ‘› Wallet</button>
  <button onclick="openPage('leader')">ğŸ† Leader</button>
  <button onclick="openPage('profile')">ğŸ‘¤ Profile</button>
  <button onclick="openPage('referral')">ğŸ‘¥ Refer</button>
</div>

<script>
/* ===== SUPABASE CONFIG ===== */
const SUPABASE_URL = "https://qytgvvitwqrfdjddfmon.supabase.co";
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InF5dGd2dml0d3FyZmRqZGRmbW9uIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjcyMzQ4MjUsImV4cCI6MjA4MjgxMDgyNX0.GXxif1AUW8si6CmZIUYhyqouETZgfEsJ1y0HwYij9dQ";
const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

/* ===== STATE ===== */
let currentUser = null;
let coins = 0;

/* ===== AUTH ===== */
async function register(){
  const email = emailEl.value;
  const password = passEl.value;
  const { error } = await supabase.auth.signUp({ email, password });
  if(error) return alert(error.message);
  alert("Registered. Now login.");
}

async function login(){
  const email = emailEl.value;
  const password = passEl.value;
  const { data, error } = await supabase.auth.signInWithPassword({ email, password });
  if(error) return alert(error.message);
  currentUser = data.user;
  initUser();
}

async function logout(){
  await supabase.auth.signOut();
  location.reload();
}

/* ===== INIT USER ===== */
async function initUser(){
  authBox.classList.add("hidden");
  openPage("home");
  pEmail.innerText = currentUser.email;
  pId.innerText = currentUser.id;

  let { data } = await supabase.from("users").select("*").eq("id", currentUser.id).single();

  if(!data){
    const ref = Math.random().toString(36).substring(2,8);
    await supabase.from("users").insert({
      id: currentUser.id,
      email: currentUser.email,
      coins: 0,
      referral_code: ref
    });
    coins = 0;
    pRef.innerText = ref;
    refCode.innerText = ref;
  }else{
    coins = data.coins;
    pRef.innerText = data.referral_code;
    refCode.innerText = data.referral_code;
  }

  updateCoins();
  loadLeaderboard();
}

/* ===== COINS ===== */
function updateCoins(){
  coinBox.innerText = coins;
  walletCoins.innerText = coins;
}

/* ===== EARN ===== */
async function earn(){
  const reward = Math.floor(Math.random()*10)+5;
  coins += reward;
  await supabase.from("users").update({ coins }).eq("id", currentUser.id);
  updateCoins();
  alert("You earned " + reward + " coins");
}

/* ===== LEADERBOARD (REAL) ===== */
async function loadLeaderboard(){
  const { data } = await supabase
    .from("users")
    .select("email, coins")
    .order("coins", { ascending:false })
    .limit(10);

  leaderList.innerHTML = "";
  data.forEach((u,i)=>{
    leaderList.innerHTML += `<p>${i+1}. ${u.email} - ${u.coins}</p>`;
  });
}

/* ===== NAV ===== */
function openPage(id){
  document.querySelectorAll(".page").forEach(p=>p.classList.add("hidden"));
  document.getElementById(id).classList.remove("hidden");
}

/* ===== ELEMENTS ===== */
const emailEl = document.getElementById("email");
const passEl = document.getElementById("password");
const authBox = document.getElementById("authBox");

/* ===== AUTO LOGIN ===== */
(async()=>{
  const { data } = await supabase.auth.getSession();
  if(data.session){
    currentUser = data.session.user;
    initUser();
  }
})();
</script>
</body>
</html>
